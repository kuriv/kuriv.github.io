## 目录

* [浅复制](#浅复制)
* [深复制](#深复制)
* [注意](#注意)
    * [当对象中的属性是引用](#当对象中的属性是引用)
* [解决方案](#解决方案)
    * [\_\_clone()](#__clone)
    * [serialize()](#serialize)
    * [json_encode()](#json_encode)



## 浅复制

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

$tom = new Cat('Tom', 6);

$butch = $tom;
$butch->name = 'Butch';

var_dump($tom, $butch);

```

输出：

```
object(Cat)#1 (2) { ["name"]=> string(5) "Butch" ["age"]=> int(6) }
object(Cat)#1 (2) { ["name"]=> string(5) "Butch" ["age"]=> int(6) }
```



## 深复制

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

$tom = new Cat('Tom', 6);

$butch = clone $tom;
$butch->name = 'Butch';

var_dump($tom, $butch);

```

输出：

```
object(Cat)#1 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) }
object(Cat)#2 (2) { ["name"]=> string(5) "Butch" ["age"]=> int(6) }
```



## 注意

### 当对象中的属性是引用

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

class Dog
{
    /**
     * Dog's name.
     *
     * @var string
     */
    public $name;

    /**
     * Store an instance of cat.
     *
     * @var Cat
     */
    public $obj;
}

$spike = new Dog;
$spike->name = 'Spike';
$spike->obj = new Cat('Tom', 6);

$tyke = clone $spike;

var_dump($spike, $tyke);

$tyke->name = 'Tyke';
$tyke->obj->age = 2;

var_dump($spike, $tyke);

```

输出：

```
object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(Dog)#3 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }

object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(2) } }
object(Dog)#3 (2) { ["name"]=> string(4) "Tyke" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(2) } }
```



## 解决方案

### \_\_clone()

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

class Dog
{
    /**
     * Dog's name.
     *
     * @var string
     */
    public $name;

    /**
     * Store an instance of cat.
     *
     * @var Cat
     */
    public $obj;

    /**
     * Complete deep copy.
     *
     * @param  void
     * @return void
     */
    public function __clone()
    {
        $this->obj = clone $this->obj;
    }
}

$spike = new Dog;
$spike->name = 'Spike';
$spike->obj = new Cat('Tom', 6);

$tyke = clone $spike;

var_dump($spike, $tyke);

$tyke->name = 'Tyke';
$tyke->obj->age = 2;

var_dump($spike, $tyke);

```

输出：

```
object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(Dog)#3 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }

object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(Dog)#3 (2) { ["name"]=> string(4) "Tyke" ["obj"]=> object(Cat)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(2) } }
```

### serialize()

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

class Dog
{
    /**
     * Dog's name.
     *
     * @var string
     */
    public $name;

    /**
     * Store an instance of cat.
     *
     * @var Cat
     */
    public $obj;
}

$spike = new Dog;
$spike->name = 'Spike';
$spike->obj = new Cat('Tom', 6);

$tyke = unserialize(serialize($spike));

var_dump($spike, $tyke);

$tyke->name = 'Tyke';
$tyke->obj->age = 2;

var_dump($spike, $tyke);

```

输出：

```
object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(Dog)#3 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }

object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(Dog)#3 (2) { ["name"]=> string(4) "Tyke" ["obj"]=> object(Cat)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(2) } }
```

### json_encode()

```php
<?php

declare(strict_types = 1);

class Cat
{
    /**
     * Cat's name.
     *
     * @var string
     */
    public $name;

    /**
     * Cat's age.
     *
     * @var int
     */
    public $age;

    /**
     * Save the name and age.
     *
     * @param  string $name
     * @param  int    $age
     * @return void
     */
    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }
}

class Dog
{
    /**
     * Dog's name.
     *
     * @var string
     */
    public $name;

    /**
     * Store an instance of cat.
     *
     * @var Cat
     */
    public $obj;
}

$spike = new Dog;
$spike->name = 'Spike';
$spike->obj = new Cat('Tom', 6);

$tyke = json_decode(json_encode($spike));

var_dump($spike, $tyke);

$tyke->name = 'Tyke';
$tyke->obj->age = 2;

var_dump($spike, $tyke);

```

输出：

```
object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(stdClass)#3 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(stdClass)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }

object(Dog)#1 (2) { ["name"]=> string(5) "Spike" ["obj"]=> object(Cat)#2 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(6) } }
object(stdClass)#3 (2) { ["name"]=> string(4) "Tyke" ["obj"]=> object(stdClass)#4 (2) { ["name"]=> string(3) "Tom" ["age"]=> int(2) } }
```